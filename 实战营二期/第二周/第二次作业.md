## 查找 close of nil channel 在runtime的位置

```go
package main

func main(){
    var ch chan int
    close(ch)
    ch <- 1
}
```

运行**go run send_to_nil.go** 会除非一个painc：**panic: close of nil channel**

#### 找到panic执行的方法

使用**go tool compile -S send_to_nil.go** 

```go
"".main STEXT size=58 args=0x0 locals=0x18 funcid=0x0
	0x0000 00000 (send_to_nil.go:3)	TEXT	"".main(SB), ABIInternal, $24-0
	0x0000 00000 (send_to_nil.go:3)	CMPQ	SP, 16(R14)
	0x0004 00004 (send_to_nil.go:3)	PCDATA	$0, $-2
	0x0004 00004 (send_to_nil.go:3)	JLS	51
	0x0006 00006 (send_to_nil.go:3)	PCDATA	$0, $-1
	0x0006 00006 (send_to_nil.go:3)	SUBQ	$24, SP
	0x000a 00010 (send_to_nil.go:3)	MOVQ	BP, 16(SP)
	0x000f 00015 (send_to_nil.go:3)	LEAQ	16(SP), BP
	0x0014 00020 (send_to_nil.go:3)	FUNCDATA	$0, gclocals·33cdeccccebe80329f1fdbee7f5874cb(SB)
	0x0014 00020 (send_to_nil.go:3)	FUNCDATA	$1, gclocals·33cdeccccebe80329f1fdbee7f5874cb(SB)
	0x0014 00020 (send_to_nil.go:5)	XORL	AX, AX
	0x0016 00022 (send_to_nil.go:5)	PCDATA	$1, $0
	0x0016 00022 (send_to_nil.go:5)	CALL	runtime.closechan(SB)
	0x001b 00027 (send_to_nil.go:6)	XORL	AX, AX
	0x001d 00029 (send_to_nil.go:6)	LEAQ	""..stmp_0(SB), BX
	0x0024 00036 (send_to_nil.go:6)	CALL	runtime.chansend1(SB)
	0x0029 00041 (send_to_nil.go:7)	MOVQ	16(SP), BP
	0x002e 00046 (send_to_nil.go:7)	ADDQ	$24, SP
	0x0032 00050 (send_to_nil.go:7)	RET
	0x0033 00051 (send_to_nil.go:7)	NOP
	0x0033 00051 (send_to_nil.go:3)	PCDATA	$1, $-1
	0x0033 00051 (send_to_nil.go:3)	PCDATA	$0, $-2
	0x0033 00051 (send_to_nil.go:3)	CALL	runtime.morestack_noctxt(SB)
	0x0038 00056 (send_to_nil.go:3)	PCDATA	$0, $-1
	0x0038 00056 (send_to_nil.go:3)	JMP	0
	0x0000 49 3b 66 10 76 2d 48 83 ec 18 48 89 6c 24 10 48  I;f.v-H...H.l$.H
	0x0010 8d 6c 24 10 31 c0 e8 00 00 00 00 31 c0 48 8d 1d  .l$.1......1.H..
	0x0020 00 00 00 00 e8 00 00 00 00 48 8b 6c 24 10 48 83  .........H.l$.H.
	0x0030 c4 18 c3 e8 00 00 00 00 eb c6                    ..........
	rel 23+4 t=7 runtime.closechan+0
	rel 32+4 t=15 ""..stmp_0+0
	rel 37+4 t=7 runtime.chansend1+0
	rel 52+4 t=7 runtime.morestack_noctxt+0
go.cuinfo.packagename. SDWARFCUINFO dupok size=0
	0x0000 6d 61 69 6e                                      main
""..inittask SNOPTRDATA size=24
	0x0000 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00  ................
	0x0010 00 00 00 00 00 00 00 00                          ........
""..stmp_0 SRODATA static size=8
	0x0000 01 00 00 00 00 00 00 00                          ........
gclocals·33cdeccccebe80329f1fdbee7f5874cb SRODATA dupok size=8
	0x0000 01 00 00 00 00 00 00 00                          ........
```

从输出可以找到第五行代码执行了```	0x0016 00022 (send_to_nil.go:5)	CALL	runtime.closechan(SB)```

#### 找到代码的具体位置

编译代码得到 send_to_nil

```go build -gcflags "all=-l -N"  send_to_nil.go``` 

调试

``` dlv exec ./send_to_nil```

打断点

```go
b runtime.closechan
```

执行

```go
c
```

找到具体代码的位置

```go
> dlv exec ./send_to_nil
Type 'help' for list of commands.
(dlv) b runtime.closechan
Breakpoint 1 set at 0x100420a for runtime.closechan() /usr/local/go/src/runtime/chan.go:355
(dlv) c
> runtime.closechan() /usr/local/go/src/runtime/chan.go:355 (hits goroutine(1):1 total:1) (PC: 0x100420a)
Warning: debugging optimized function
   350:		src := sg.elem
   351:		typeBitsBulkBarrier(t, uintptr(dst), uintptr(src), t.size)
   352:		memmove(dst, src, t.size)
   353:	}
   354:
=> 355:	func closechan(c *hchan) {
   356:		if c == nil {
   357:			panic(plainError("close of nil channel"))
   358:		}
   359:
   360:		lock(&c.lock)
(dlv)
```

查看上面输出可以得到具体位置**/usr/local/go/src/runtime/chan.go:355**

